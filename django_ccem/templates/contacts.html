{% extends 'ccem_sim/base.html' %}
{% load url_extras %}

{% block left_panel %}
	<div style="height:400px; overflow:scroll;">
	<ul class="nav nav-pills nav-stacked">
		{% for c in contacts %}
		<li {% if request.GET.contact == c.phone_number %} class="active" {% endif %}><a href="{% url 'django_ccem.views.contacts' %}?contact={{ c.phone_number }}">{{ c.name }} | {{ c.phone_number }}</a></li>
		{% endfor %}
	</ul>
	</div>
{% endblock %}	






{% block content %}
{% if contact_detail %}
<dl class="dl-horizontal">
  <dt>Name:</dt><dd>{{contact_detail.name}}</dd>
  <dt>Number:</dt><dd>{{contact_detail.phone_number}}</dd>
  <dt>Health Unit:</dt><dd>{{contact_detail.facility}}</dd>
  <dt>Send Message:</dt>
  <dd>
  	<div class="form-group">
  		<textarea class="form-control" rows="3" style="width:400px"></textarea>
  	</div>
  	<div class="form-group">
			<button type="submit" class="btn btn-default">Sign in</button>
    </div>
  </dd>
</dl>


{% if messages %}
<div style="width:600px">
<table class="table table-hover table-bordered">
<tr class='info'>
	<!--<th style="width:200px"><span class="glyphicon chevron-down"></span>Date</th>-->
	<th style="width:400px;">Message</th>
	<!--<th style="width:150px">Contact</th>
	<th>Health Unit</th>-->
</tr>
{% for m in messages %}
<tr>
	<td style="border:0px">
		<span class="alert alert-{% if not m.has_error %}info{% else %}danger{% endif %}">{{ m.message.text }}</span>
		<span class="glyphicon glyphicon-{% if m.is_submission %}ok-sign{% else %}question-sign{% endif %}"></span>
		<div style="width:100%" class="text-center"><small>{{ m.created }}</small></div>
	</td>
	<!--<td><a href="?{% url_replace request 'contact' m.message.connection.identity %}">{{ m.message.connection.identity }}</a></td>
	<td>{{m.message.connection.dhis2_contact.contact.facility}}</td>-->
</tr>
{% for r in m.report_set.all %}
	<td style="border:0px" class="text-right">
		<span class="glyphicon glyphicon-share-alt"></span>
		<span class="alert alert-{% if not r.has_error %}info{% else %}danger{% endif %}">{{ r.response.text }}</span>
		<div style="width:100%;" class="text-center"><small>{{ r.created }}</small></div>
	</td>
</tr>
{% endfor %}

{% endfor %}
</table>

<div class='pager'>

{% if messages.has_previous %}
	<li><a href="?{% url_replace request 'page' messages.previous_page_number %}">Previous</a></li>
{% else  %}
	<li class='disabled'><a href='#'>Previous</a><li>
{% endif %}

{% if messages.paginator.num_pages > 1 %}
Page <form action='#', method='get'>
	<input type='text' name='page' value='{{messages.number}}'/>
	<input type='submit' value='Go'/>
	</form> of {{messages.paginator.num_pages }}
{% else %}
	Page 1 of 1
{% endif %}
({{ messages.paginator.count }} Messages)

{% if messages.has_next %}
	<li><a href="?{% url_replace request 'page' messages.next_page_number %}">Next</a></li>
{% else  %}
	<li class='disabled'><a href='#'>Next</a></li>
{% endif %}

{% else %}

<div class='panel panel-warning'>
	<div class='panel-heading'>
		<h3 class='panel-title'>Message</h3>
	</div>
	<div class='panel-body'>
		No messages were found for this contact.
	</div>
</div>

{% endif %}

{% else %}
<div class='panel panel-warning'>
	<div class='panel-heading'>
		<h3 class='panel-title'>Message</h3>
	</div>
	<div class='panel-body'>
		Please select a contact from the left panel.
	</div>
</div>
</div>
{% endif %}

{% endblock %}
